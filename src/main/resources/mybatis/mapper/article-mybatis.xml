<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lixc.bureau.dao.IArticleDAO">


    <select id="getCategoryEntityById" resultType="com.lixc.bureau.entity.CategoryEntity">
        SELECT  * from sys_category where id= #{id}
    </select>

    <select id="getCategoryEntityByType" resultType="com.lixc.bureau.entity.CategoryEntity">
        SELECT  * from sys_category where type= #{type}
    </select>
    <select id="getArticals" resultType="com.lixc.bureau.entity.Article">
        SELECT id,title,createTime,createBy ,updateTime,updateBy from sys_article where is_deleted = 'N'
        and c_id = #{c_id}
        order  by createTime desc
        <if test="mod != null">
            limit 7
        </if>
    </select>
    <select id="getCareList" resultType="com.lixc.bureau.entity.Article">
        SELECT id,content from sys_article where is_deleted = 'N'
        and c_id = #{c_id}
        order  by createTime desc
        <if test="mod != null">
            limit 7
        </if>
    </select>
    <select id="getAllArticlesByCid" resultType="com.lixc.bureau.entity.Article">
        SELECT id,content,title,createTime from sys_article where is_deleted = 'N'
        and c_id = #{c_id}
        order  by createTime desc
         limit #{start},#{end}
    </select>
    <select id="getAllArticleCountByCid" resultType="java.lang.Integer">
        SELECT count(1) from sys_article where is_deleted = 'N'
        and c_id = #{c_id}
        order  by createTime desc
    </select>


    <select id="getArticleById" resultType="com.lixc.bureau.entity.Article">
        SELECT * from sys_article  WHERE  `id` = #{id}  and is_deleted= 'N'
    </select>
    <select id="getAnnexById" resultType="com.lixc.bureau.entity.Annex">
        SELECT * from sys_annex  WHERE  `id` = #{id}
    </select>

    <select id="getAllCategorise" resultType="com.lixc.bureau.entity.CategoryEntity">
        SELECT * from sys_category order by id asc
    </select>

    <select id="getArticleListByCID" parameterType="com.lixc.bureau.entity.Article" resultType="com.lixc.bureau.entity.Article">
        SELECT * from sys_article where c_id = #{c_id}
         <if test="title != null and title != ''">
             and title like CONCAT('%', #{title}, '%')
         </if>
        <if test="createBy != null and createBy != ''">
            and createBy like CONCAT('%', #{createBy}, '%')
        </if>
         and is_deleted= 'N' order by createTime desc
    </select>

    <insert id="addArticle" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO sys_article (
        c_id,
        title,
        content,
        createTime,
        createBy,
        a_id
    )
    VALUES
        (
            #{c_id},
            #{title},
            #{content},
            NOW(),
            #{createBy},
            #{a_id}
        )
    </insert>

    <update id="editArticle">
        update  sys_article set c_id= #{article.c_id},
        title = #{article.title},
        content = #{article.content},
        updateTime = now(),
        updateBy = #{user_id}
        where id = #{article.id}
        and is_deleted= 'N'
    </update>
    <update id="updateArticle">
        update  sys_article set
          is_deleted= #{article.is_deleted},
          updateTime = now(),
          updateBy = #{user_id}
        where id = #{article.id}
    </update>
    <insert id="addAnnex" useGeneratedKeys="true" keyProperty="id">
        insert into sys_annex (fileName,saveName,url,create_time) values (
          #{fileName},#{saveName},#{url},now()
        )
    </insert>


</mapper>